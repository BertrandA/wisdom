/*
 * #%L
 * Wisdom-Framework
 * %%
 * Copyright (C) 2013 - 2014 Wisdom Framework
 * %%
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
(function(){var e,d,c;e="undefined"!==typeof global&&null!==global?global:this;e.HUBU=null!=(d=e.HUBU)?d:{};e.HUBU.extensions=null!=(c=e.HUBU.extensions)?c:{};e.hubu=function(){return e.HUBU};e.getHubuExtensions=function(){return HUBU.extensions};e.getGlobal=function(){return e}}).call(this);
(function(){HUBU.AbstractComponent=function(){function e(){}e.prototype.configure=function(){throw"AbstractComponent is an abstract class";};e.prototype.start=function(){throw"AbstractComponent is an abstract class";};e.prototype.stop=function(){throw"AbstractComponent is an abstract class";};e.prototype.getComponentName=function(){throw"AbstractComponent is an abstract class";};return e}()}).call(this);
(function(){var e,d,c,a=[].slice;HUBU.UTILS=null!=(e=HUBU.UTILS)?e:{};c=HUBU.UTILS;getGlobal().namespace=function(b,f,l){var c,d,g,e,k;3>arguments.length&&(c=["undefined"!==typeof exports?exports:window].concat(a.call(arguments)),b=c[0],f=c[1],l=c[2]);d=b;k=f.split(".");g=0;for(e=k.length;g<e;g++)c=k[g],b=b[c]||(b[c]={});return l(b,d)};getGlobal().Logger=e=function(){function b(b){null==b&&(b="");0<b.length&&(this._header="["+b+"] ")}b.DEBUG=0;b.INFO=1;b.WARNING=2;b.ERROR=3;b.prototype._header="";
b.prototype._level=b.INFO;b.prototype._getConsole=function(){return null!=("undefined"!==typeof window&&null!==window?window.console:void 0)?window.console:null!=("undefined"!==typeof global&&null!==global?global.console:void 0)?global.console:null};b.prototype.log=function(b){return null!=this._getConsole()?(this._getConsole().log(""+this._header+b),!0):!1};b.prototype.debug=function(f){return this._level<=b.DEBUG?this.log("DEBUG - "+f):!1};b.prototype.info=function(f){return this._level<=b.INFO?
this.log("INFO - "+f):!1};b.prototype.warn=function(f){return this._level<=b.WARNING?this.log("WARN - "+f):!1};b.prototype.error=function(f){if(this._level<=b.ERROR)return this.log("ERROR - "+f)};b.prototype.setLevel=function(b){return this._level=b};return b}();HUBU.logger=new e("hubu");d=HUBU.logger;getGlobal().Exception=function(){function b(b){this.message=b}b.prototype.data={};b.prototype.add=function(b,a){this.data.key=a;return this};b.prototype.toString=function(){return this.message};return b}();
c.typeOf=function(b){var f,a,c,d,g;if(null==b)return new String(b);f={};g="Boolean Number String Function Array Date RegExp".split(" ");c=0;for(d=g.length;c<d;c++)a=g[c],f["[object "+a+"]"]=a.toLowerCase();b=Object.prototype.toString.call(b);return b in f?f[b]:"object"};c.isObjectConformToContract=function(b,f){for(var a in f){if(null==b[a])return d.warn("Object not conform to contract - property "+a+" missing"),!1;if(this.typeOf(f[a])!==this.typeOf(b[a]))return d.warn("Object not conform to contract - the type of the property "+
a+" does not match.          Expected '"+this.typeOf(f[a])+"' but found '"+this.typeOf(b[a])+"'"),!1}return!0};c.isFunction=function(b){return"function"===this.typeOf(b)};c.isObject=function(b){return"object"===this.typeOf(b)};c.invoke=function(b,f,a){return null!=b[f]&&this.isFunction(b[f])?b[f].apply(b,a):!1};c.defineFunctionIfNotExist=function(b,f,a){return null==b[f]?(b[f]=a,!0):!1};c.clone=function(b,f){var a,c;if(null==b||"object"!==typeof b)return b;if(b instanceof Date)return new Date(b.getTime());
if(b instanceof RegExp)return a="",null!=b.global&&(a+="g"),null!=b.ignoreCase&&(a+="i"),null!=b.multiline&&(a+="m"),null!=b.sticky&&(a+="y"),RegExp(b.source,a);c=new b.constructor;f=null!=f?f:[];for(a in b)-1===this.indexOf(f,a)&&(c[a]=this.clone(b[a],f));return c};c.bind=function(b,f){if("string"===this.typeOf(f))if(null!=b[f])f=b[f];else throw"HUBU.bind: obj["+f+"] is null";if("function"===this.typeOf(f))return function(){return f.apply(b,Array.prototype.slice.call(arguments))};throw"HUBU.bind: obj["+
f+"] is not a function";};c.createProxyForContract=function(b,f){var a,c;c={};c.__proxy__=f;for(a in b)c[a]=this.isFunction(b[a])?this.bind(f,f[a]):f[a];return c};c.isComponent=function(b){return null==b?!1:this.isObjectConformToContract(b,new HUBU.AbstractComponent)};c.isComponentPlugged=function(b,f){return"string"===this.typeOf(b)?null!==f.getComponent(b):"object"===this.typeOf(b)?-1!==this.indexOf(f.getComponents(),b):!1};c.indexOf=function(b,f){var a,c,d,g;if(null!=Array.prototype.indexOf)return b.indexOf(f);
a=d=0;for(g=b.length;d<g;a=++d)if(c=b[a],c===f)return a;return-1};c.removeElementFromArray=function(b,f){for(var a in b)b[a]===f&&b.splice(a,1);return b}}).call(this);
(function(){var e,d=[].slice;HUBU.Eventing=e=function(){function c(a){var b;this._hub=a;this._listeners=[];b=this;this._hub.getListeners=function(){return b._listeners};this._hub.registerListener=function(){var f,a;f=arguments[0];a=2<=arguments.length?d.call(arguments,1):[];2<=a.length?b.registerListener(f,a[0],a[1]):b.registerListener(f,a[1]);return this};this._hub.registerConfigurableListener=function(a,c){HUBU.logger.warn("registerConfigurableListener is a deprecated method and may disappear at any time, use registerListener instead");
b.registerListener(a,c);return this};this._hub.unregisterListener=function(a,c){b.unregisterListener(a,c);return this};this._hub.sendEvent=function(a,c){return b.sendEvent(a,c)};this._hub.subscribe=function(a,c,d,h){b.subscribe(a,c,d,h);return this};this._hub.unsubscribe=function(a,c){b.unsubscribe(a,c);return this};this._hub.publish=function(a,c,d){b.publish(a,c,d);return this}}c.prototype._hub=null;c.prototype._listeners=null;c.prototype._processEvent=function(a,b){var f,c,d,h,g,e;if(null==b||null==
a)return HUBU.logger.warn("Can't process event - component or event not defined"),!1;d=!1;e=this._listeners.slice();h=0;for(g=e.length;h<g;h++)c=e[h],c.component!==a&&-1!==HUBU.UTILS.indexOf(this._listeners,c)&&(f=null==b.clone||b.clone?HUBU.UTILS.clone(b):b,f.source=a,c.match.apply(c.component,[f])&&(c.callback.apply(c.component,[f]),d=!0));return d};c.prototype.registerListener=function(){var a,b,f,c;b=arguments[0];c=2<=arguments.length?d.call(arguments,1):[];a=f=null;switch(c.length){case 2:f=
c[0];a=c[1];break;case 1:f=c[0].match,a=c[0].callback}if(null==b||null==f||null==a)throw(new Exception("Cannot register event listener, component or match or callback is/are not defined")).add("component",b).add("match",f).add("callback",a);if(!HUBU.UTILS.isComponentPlugged(b,this._hub))throw new Exception("Cannot register event listener, the component is not plugged on the hub");return this._listeners.push({component:b,callback:a,match:f})};c.prototype.unregisterListener=function(a,b){var f,c,d,
h,g,e;if(null==a)return HUBU.logger.warn("Cannot unregister listener - component not defined"),!1;f=this.getComponent(a);if(null==f)return HUBU.logger.warn("Cannot unregister listener - component not plugged on the hub"),!1;d=[];if(null!=b){e=this._listeners;h=0;for(g=e.length;h<g;h++)c=e[h],c.component===f&&c.callback===b&&d.push(c)}else{e=this._listeners;h=0;for(g=e.length;h<g;h++)c=e[h],c.component===f&&d.push(c)}g=[];f=0;for(h=d.length;f<h;f++)c=d[f],g.push(this._listeners=HUBU.UTILS.removeElementFromArray(this._listeners,
c));return g};c.prototype.getComponent=function(a){return"string"===HUBU.UTILS.typeOf(a)?this._hub.getComponent(a):HUBU.UTILS.isComponent(a)?a:null};c.prototype.sendEvent=function(a,b){if(null==a||null==b)HUBU.logger.warn("Cannot send event, component or/and event are undefined");else return this._processEvent(a,b)};c.prototype.subscribe=function(a,b,c,d){var i;if(null==a||null==b||null==c)HUBU.logger.warn("Cannot subscribe to topic, component or/and topic and/or callback are undefined");else return i=
RegExp(b),b=null,b=null==d||!HUBU.UTILS.isFunction(d)?function(b){return i.test(b.topic)}:function(b){return i.test(b.topic)&&d(b)},this.registerListener(a,b,c)};c.prototype.unsubscribe=function(a,b){return this.unregisterListener(a,b)};c.prototype.publish=function(a,b,c){if(null==a||null==b||null==c)return HUBU.logger.info("Cannot publish event - component and/or topic and/or event are missing"),!1;c.topic=b;return this.sendEvent(a,c)};c.prototype.reset=function(){return this._listeners=[]};c.prototype.unregisterComponent=
function(a){return this.unregisterListener(a)};return c}();getHubuExtensions().eventing=e}).call(this);
(function(){var e;HUBU.Binding=e=function(){function d(c){var a;this._hub=c;a=this;this._hub.bind=function(b){a.bind(b);return this}}d.prototype._hub=null;d.prototype.getComponent=function(c){return"string"===HUBU.UTILS.typeOf(c)?this._hub.getComponent(c):HUBU.UTILS.isComponent(c)?c:null};d.prototype.getInjectedObject=function(c,a){if(null!=c.contract)if(HUBU.UTILS.isObjectConformToContract(a,c.contract)){if(null==c.proxy||c.proxy)return HUBU.UTILS.createProxyForContract(c.contract,a)}else throw(new Exception("Cannot bind components, the component is not conform to contract")).add("component",
a.getComponentName()).add("contract",c.contract);return a};d.prototype.bind=function(c){var a,b;if(null==c||!(null!=c&&c.to)||!(null!=c&&c.component)||!(null!=c&&c.into))throw new Exception("Cannot bind components - component, to and into must be defined");a=this.getComponent(c.component);if(null==a)throw(new Exception("Cannot bind components - 'component' is invalid")).add("component",c.component);b=this.getComponent(c.to);if(null==b)throw(new Exception("Cannot bind components - 'to' is invalid")).add("component",
c.to);a=this.getInjectedObject(c,a);switch(HUBU.UTILS.typeOf(c.into)){case "function":return c.into.apply(b,[a]);case "string":return null==b[c.into]?b[c.into]=a:HUBU.UTILS.isFunction(b[c.into])?b[c.into].apply(b,[a]):b[c.into]=a;default:throw(new Exception("Cannot bind components = 'into' must be either a function or a string")).add("into",c.into);}};return d}();getHubuExtensions().binding=e}).call(this);
(function(){var e,d,c;getGlobal().SOC=null!=(c=getGlobal().SOC)?c:{};e=getGlobal().SOC;e.ServiceRegistration=d=function(){function a(b,a,c,d,h,e){this._id=-1;if(null==a)throw new Exception("Cannot create a service registration without a valid component");if(null==c)throw new Exception("Cannot create a service registration without a valid service object");if(null==b)throw new Exception("Cannot create a service registration without a contract");if(null==h)throw new Exception("Cannot create a service registration without the hub");
if(null==e)throw new Exception("Cannot create a service registration without the registry");this._component=a;this._hub=h;this._contract=b;this._properties="undefined"===typeof d||null===d?{}:HUBU.UTILS.clone(d);this._registry=e;this._svcObject=c;this._properties["service.contract"]=this._contract;this._properties["service.publisher"]=this._component}a._nextId=1;a.prototype._id=-1;a.prototype._component=null;a.prototype._contract=null;a.prototype._hub=null;a.prototype._registered=!1;a.prototype._properties=
{};a.prototype._reference=null;a.prototype._registry=null;a.prototype._svcObject=null;a.getAndIncId=function(){var b;b=e.ServiceRegistration._nextId;e.ServiceRegistration._nextId+=1;return b};a.prototype.register=function(){if(!(HUBU.UTILS.isComponentPlugged(this._component,this._hub)||this._component===this._hub))throw new Exception("Invalid registration, the component is not plugged on the hub");this._id=e.ServiceRegistration.getAndIncId();this._reference=new e.ServiceReference(this);this._properties["service.id"]=
this._id;this._registered=-1!==this._id;return this._id};a.prototype.unregister=function(){return this._registered=!1};a.prototype.isRegistered=function(){return this._registered};a.prototype.getReference=function(){if(!(HUBU.UTILS.isComponentPlugged(this._component,this._hub)||this._component===this._hub))throw new Exception("Invalid lookup, the component is not plugged on the hub");return this._reference};a.prototype.getProperties=function(){return this._properties};a.prototype.getService=function(b){return!HUBU.UTILS.isFunction(this._svcObject)?
this._svcObject:this._svcObject.apply(this._component,[b])};a.prototype.setProperties=function(b){var a;a=null;this.isRegistered()&&(a=HUBU.UTILS.clone(this._properties,["service.contract","service.publisher"]),a=new e.ServiceRegistration(this._contract,this._component,this._svcObject,a,this._hub,this._registry),a._id=this._id,a._reference=new e.ServiceReference(a));this._properties=null!=b?b:{};this._properties["service.contract"]=this._contract;this._properties["service.publisher"]=this._component;
this._properties["service.id"]=this._id;if(this.isRegistered()&&null!=a)return b=new e.ServiceEvent(e.ServiceEvent.MODIFIED,this.getReference()),this._registry.fireServiceEvent(b,a.getReference())};return a}();e.ServiceReference=function(){function a(b){this._registration=b}a.prototype._registration=null;a.prototype.getContract=function(){return this._registration.getProperties()["service.contract"]};a.prototype.getProperties=function(){return this._registration.getProperties()};a.prototype.getProperty=
function(b){return this._registration.getProperties()[b]};a.prototype.getId=function(){return this._registration.getProperties()["service.id"]};a.prototype.isValid=function(){return this._registration.isRegistered};return a}();e.ServiceEvent=function(){function a(b,a){this._type=b;this._reference=a}a.REGISTERED=1;a.MODIFIED=2;a.UNREGISTERING=4;a.MODIFIED_ENDMATCH=8;a.prototype._type=0;a.prototype._reference=null;a.prototype.getReference=function(){return this._reference};a.prototype.getType=function(){return this._type};
return a}();e.ServiceRegistry=function(){function a(b){this._registrations=[];this._listeners=[];if(null==b)throw new Exception("Cannot initialize the service registry without a hub");this._hub=b}a.prototype._registrations=null;a.prototype._hub=null;a.prototype._listeners=null;a.prototype.getRegisteredServices=function(){var b,a,c,d,h,e,j,k;a=[];j=this._registrations;c=0;for(h=j.length;c<h;c++){b=j[c];k=b.registrations;d=0;for(e=k.length;d<e;d++)b=k[d],a.push(b.getReference())}return a};a.prototype._addRegistration=
function(b,a){var c,d,e,g,j;j=this._registrations;e=0;for(g=j.length;e<g;e++)d=j[e],d.component===b&&(c=d);null==c&&(c={component:b,registrations:[]},this._registrations.push(c));return c.registrations.push(a)};a.prototype._removeRegistration=function(b){var a,c,d,e,g;g=this._registrations;d=0;for(e=g.length;d<e;d++)c=g[d],-1!==HUBU.UTILS.indexOf(c.registrations,b)&&(a=c);if(null==a)return null;HUBU.UTILS.removeElementFromArray(a.registrations,b);0===a.registrations.length&&HUBU.UTILS.removeElementFromArray(this._registrations,
a);return a.component};a.prototype.registerService=function(b,a,c,i){if(null==a)throw new Exception("Cannot register a service without a proper contract");if(null==b)throw new Exception("Cannot register a service without a valid component");i=null!=i?i:b;if(!HUBU.UTILS.isFunction(i)&&!HUBU.UTILS.isObjectConformToContract(i,a))throw(new Exception("Cannot register service - the service object does not implement the contract")).add("contract",a).add("component",b);a=new d(a,b,null!=i?i:b,c,this._hub,
this);this._addRegistration(b,a);a.register();this.fireServiceEvent(new e.ServiceEvent(e.ServiceEvent.REGISTERED,a.getReference()));return a};a.prototype.unregisterService=function(b){var a;if(null==b)throw new Exception("Cannot unregister the service - invalid registration");if(null!=this._removeRegistration(b))return a=b.getReference(),b.unregister(),this.fireServiceEvent(new e.ServiceEvent(e.ServiceEvent.UNREGISTERING,a)),!0;throw new Exception("Cannot unregister service - registration not found");
};a.prototype.unregisterServices=function(b){var a,c,d,e,g;if(null==b)throw new Exception("Cannot unregister the services - invalid component");g=this._registrations;d=0;for(e=g.length;d<e;d++)c=g[d],c.component===b&&(a=c);if(null!=a){c=a.registrations;if(null!=c){d=0;for(e=c.length;d<e;d++)b=c[d],this.unregisterService(b)}return HUBU.UTILS.removeElementFromArray(this._registrations,a)}};a.prototype.getServiceReferences=function(b,a){return this._match(this._buildFilter(b,a))};a.prototype._match=
function(b){var a,c;c=this.getRegisteredServices();var d,e,g;g=[];d=0;for(e=c.length;d<e;d++)a=c[d],b.match(a)&&g.push(a);return g};a.prototype._buildFilter=function(b,a){var c;return null==b&&null==a?{match:function(){return!0}}:null!=b&&null==a?(c={},c.contract=b,c.match=function(b){return b.getProperty("service.contract")===c.contract},c):null!=b&&null!=a?(c={},c.contract=b,c.filter=a,c.match=function(b){return b.getProperty("service.contract")===c.contract&&c.filter(b)},c):{filter:a,match:function(b){return this.filter(b)}}};
a.prototype.getService=function(b,a){if(null==a)throw new Exception("Cannot get service - the reference is null");return!a.isValid()?(HUBU.logger.warn("Cannot retrieve service for "+a+" - the reference is invalid"),null):a._registration.getService(b)};a.prototype.ungetService=function(){};a.prototype.registerServiceListener=function(b){var a,c,d;a=b.contract;c=b.filter;d=b.listener;if(null==d)throw(new Exception("Can't register the service listener, the listener is not set")).add("listenerConfig",
b);b=this._buildFilter(a,c);a={listener:d,filter:b,contract:a};if(HUBU.UTILS.isObject(d)&&!HUBU.UTILS.isObjectConformToContract(d,e.ServiceListener))throw new Exception("Can't register the service listener, the listener is not conform to the Service Listener contract");return this._listeners.push(a)};a.prototype.unregisterServiceListener=function(b){var a,c,d,e,g,j;a=b.contract;c=b.listener;if(null==c)throw(new Exception("Can't unregister the service listener, the listener is not set")).add("listenerConfig",
b);g=this._listeners.slice();j=[];d=0;for(e=g.length;d<e;d++)b=g[d],b.contract===a&&b.listener===c&&j.push(HUBU.UTILS.removeElementFromArray(this._listeners,b));return j};a.prototype.fireServiceEvent=function(a,c){var d,i,h,g,j,k;j=this._listeners;k=[];h=0;for(g=j.length;h<g;h++)d=j[h],(i=null==d.filter||this._testAgainstFilter(d,a.getReference()))?k.push(this._invokeServiceListener(d,a)):a.getType()===e.ServiceEvent.MODIFIED&&null!=c?this._testAgainstFilter(d,c)?(i=new e.ServiceEvent(e.ServiceEvent.MODIFIED_ENDMATCH,
a.getReference()),k.push(this._invokeServiceListener(d,i))):k.push(void 0):k.push(void 0);return k};a.prototype._testAgainstFilter=function(a,c){return a.filter.match(c)};a.prototype._invokeServiceListener=function(a,c){if(HUBU.UTILS.isFunction(a.listener))return a.listener(c);if(HUBU.UTILS.isObject(a.listener))return a.serviceChanged(c)};return a}()}).call(this);
(function(){var e;HUBU.ServiceComponent=function(){function d(c){this._component=c;this._providedServices=[];this._requiredServices=[];this._state=d.STOPPED}d.STOPPED=0;d.INVALID=1;d.VALID=2;d.prototype._component=null;d.prototype._providedServices=null;d.prototype._requiredServices=null;d.prototype._state=0;d.prototype.getComponent=function(){return this._component};d.prototype.getState=function(){return this._state};d.prototype.addProvidedService=function(c){if(-1===HUBU.UTILS.indexOf(this._providedServices,
c)){this._providedServices.push(c);c.setServiceComponent(this);if(this._state>d.STOPPED)c.onStart();if(this._state===d.VALID)c.onValidation();if(this._state===d.INVALID)return c.onInvalidation()}};d.prototype.removeProvidedService=function(c){if(-1!==HUBU.UTILS.indexOf(this._providedServices,c))return HUBU.UTILS.removeElementFromArray(this._providedServices,c),c.onStop()};d.prototype.addRequiredService=function(c){if(-1===HUBU.UTILS.indexOf(this._requiredServices,c)&&(this._requiredServices.push(c),
c.setServiceComponent(this),this._state>d.STOPPED))return c.onStart(),this.computeState()};d.prototype.removeRequiredService=function(c){if(-1<HUBU.UTILS.indexOf(this._requiredServices,c)&&(HUBU.UTILS.removeElementFromArray(this._requiredServices,c),c.onStop(),this._state>d.STOPPED))return this.computeState()};d.prototype.computeState=function(){var c,a,b,f,e;c=!0;e=this._requiredServices;b=0;for(f=e.length;b<f;b++)a=e[b],c=c&&a.isValid();a=this._state;this._state=c?d.VALID:d.INVALID;this._state>
a&&this._state===d.VALID?this._validate():this._state<a&&this._state===d.INVALID&&this._invalidate();return this._state};d.prototype._validate=function(){var c,a,b,d,e;HUBU.logger.debug("Validate instance "+(null!=(c=this._component)?c.getComponentName():void 0));d=this._providedServices;e=[];a=0;for(b=d.length;a<b;a++)c=d[a],e.push(c.onValidation());return e};d.prototype._invalidate=function(){var c,a,b,d,e;HUBU.logger.debug("Invalidate instance");d=this._providedServices;e=[];a=0;for(b=d.length;a<
b;a++)c=d[a],e.push(c.onInvalidation());return e};d.prototype.onStart=function(){var c,a,b,d;d=this._requiredServices;a=0;for(b=d.length;a<b;a++)c=d[a],c.onStart();d=this._providedServices;a=0;for(b=d.length;a<b;a++)c=d[a],c.onStart();return this.computeState()};d.prototype.onStop=function(){var c,a,b,f;f=this._providedServices;a=0;for(b=f.length;a<b;a++)c=f[a],c.onStop();f=this._requiredServices;a=0;for(b=f.length;a<b;a++)c=f[a],c.onStop();return this._state=d.STOPPED};d.prototype.getServiceDependencyByName=
function(c){var a,b,d,e;e=this._requiredServices;b=0;for(d=e.length;b<d;b++)if(a=e[b],a.getName()===c)return a};return d}();HUBU.ServiceDependency=function(){function d(c,a,b,d,e,i,h,g,j,k){var m;this._component=c;this._contract=a;this._filter=b;this._aggregate=d;this._optional=e;this._field=i;this._name=null!=j?j:this._contract;if(null!=h&&(this._bind=HUBU.UTILS.isFunction(h)?h:this._component[h],null==this._bind))throw new Exception("Bind method "+h+" not found on component");if(null!=g&&(this._unbind=
HUBU.UTILS.isFunction(g)?g:this._component[g],null==this._unbind))throw new Exception("Unbind method "+g+" not found on component");this._hub=k;this._state=HUBU.ServiceDependency.UNRESOLVED;this._refs=[];m=this;this._listener={contract:this._contract,filter:function(a){return a.getProperty("service.publisher")!==m._component&&(null==m._filter||m._filter(a))},listener:function(a){switch(a.getType()){case SOC.ServiceEvent.REGISTERED:return m._onServiceArrival(a.getReference());case SOC.ServiceEvent.MODIFIED:return m._onServiceModified(a.getReference());
case SOC.ServiceEvent.UNREGISTERING:return m._onServiceDeparture(a.getReference());case SOC.ServiceEvent.MODIFIED_ENDMATCH:return m._onServiceDeparture(a.getReference())}}}}d.UNRESOLVED=0;d.RESOLVED=1;d.prototype._component=null;d.prototype._contract=null;d.prototype._filter=null;d.prototype._aggregate=!1;d.prototype._optional=!1;d.prototype._field=null;d.prototype._bind=null;d.prototype._unbind=null;d.prototype._name=null;d.prototype._hub=null;d.prototype.setServiceComponent=function(c){return this._serviceComponent=
c};d.prototype.onStart=function(){this._state=HUBU.ServiceDependency.UNRESOLVED;this._startTracking();return this._computeDependencyState()};d.prototype.onStop=function(){this._stopTracking();this._ungetAllServices();this._refs=[];return this._state=HUBU.ServiceDependency.UNRESOLVED};d.prototype._ungetAllServices=function(){var c,a,b,d,e;d=this._refs;e=[];a=0;for(b=d.length;a<b;a++)c=d[a],null!=c.service&&(c.service=null,e.push(this._hub.ungetService(this._component,c.reference)));return e};d.prototype._startTracking=
function(){var c,a,b,d,e;this._hub.registerServiceListener(this._listener);a=this._hub.getServiceReferences(this._contract,this._filter);e=[];b=0;for(d=a.length;b<d;b++)c=a[b],e.push(this._onServiceArrival(c));return e};d.prototype._stopTracking=function(){return this._hub.unregisterServiceListener(this._listener)};d.prototype.isValid=function(){return this._state===HUBU.ServiceDependency.RESOLVED};d.prototype.getName=function(){return this._name};d.prototype.getContract=function(){return this._contract};
d.prototype.getFilter=function(){return this._filter};d.prototype.isAggregate=function(){return this._aggregate};d.prototype.isOptional=function(){return this._optional};d.prototype._computeDependencyState=function(){var c;c=this._state;this._state=this._optional||0<this._refs.length?HUBU.ServiceDependency.RESOLVED:HUBU.ServiceDependency.UNRESOLVED;if(c!==this._state)return this._serviceComponent.computeState()};d.prototype._onServiceArrival=function(c){var a,b,d,e,i;HUBU.logger.debug("Service arrival detected for "+
this._component.getComponentName());i=this._refs;d=0;for(e=i.length;d<e;d++)a=i[d],a.reference===c&&(b=a);if(null==b&&(b={reference:c,service:null},this._refs.push(b),this._computeDependencyState(),this._aggregate||1===this._refs.length))return this._inject(b)};d.prototype._onServiceDeparture=function(c){var a,b,d,e,i;HUBU.logger.debug("Service departure detected for "+this._component.getComponentName());i=this._refs;d=0;for(e=i.length;d<e;d++)a=i[d],a.reference===c&&(b=a);if(null!=b)if(HUBU.UTILS.removeElementFromArray(this._refs,
b),null!=b.service&&(this._deinject(b),this._hub.ungetService(this._component,c),b.service=null),0<this._refs.length){if(c=this._refs[0],!this._aggregate)return this._inject(c)}else return this._computeDependencyState()};d.prototype._onServiceModified=function(c){var a,b,d,e,i;i=this._refs;d=0;for(e=i.length;d<e;d++)a=i[d],a.reference===c&&(b=a);if(null==b)return this._onServiceArrival(c)};d.prototype._inject=function(c){var a;a=this._hub.getService(this._serviceComponent,c.reference);c.service=a;
null!=this._field&&this._aggregate&&(null==this._component[this._field]?this._component[this._field]=[a]:this._component[this._field].push(a));null!=this._field&&!this._aggregate&&(this._component[this._field]=a);if(null!=this._bind)return this._bind.apply(this._component,[a,c.reference])};d.prototype._deinject=function(c){null!=this._field&&this._aggregate&&HUBU.UTILS.removeElementFromArray(this._component[this._field],c.service);null!=this._field&&!this._aggregate&&(this._component[this._field]=
null);if(null!=this._unbind)return this._unbind.apply(this._component,[c.service,c.reference])};d.prototype.locateServices=function(){var c,a,b,d,e;b=[];a=this._hub.getServiceReferences(this._contract,this._filter);d=0;for(e=a.length;d<e;d++)c=a[d],b.push(this._hub.getService(this._component,c));return b};return d}();HUBU.ProvidedService=function(){function d(c,a,b,d,e,i,h,g){this._component=c;this._contract=a;this._hub=g;this._properties=b;if(null!=d&&(this._preRegistration=HUBU.UTILS.isFunction(d)?
d:this._component[d],null==this._preRegistration))throw new Exception("preRegistration method "+d+" not found on component");if(null!=e&&(this._postRegistration=HUBU.UTILS.isFunction(e)?e:this._component[e],null==this._postRegistration))throw new Exception("postRegistration method "+e+" not found on component");if(null!=i&&(this._preUnregistration=HUBU.UTILS.isFunction(i)?i:this._component[i],null==this._preUnregistration))throw new Exception("preUnregistration method "+i+" not found on component");
if(null!=h&&(this._postUnRegistration=HUBU.UTILS.isFunction(h)?h:this._component[h],null==this._postUnRegistration))throw new Exception("postUnregistration method "+h+" not found on component");}d.UNREGISTERED=0;d.REGISTERED=1;d.prototype._hub=null;d.prototype._contract=null;d.prototype._properties=null;d.prototype._registration=null;d.prototype._serviceComponent=null;d.prototype._component=null;d.prototype._preRegistration=null;d.prototype._postRegistration=null;d.prototype._preUnregistration=null;
d.prototype._postUnRegistration=null;d.prototype.setServiceComponent=function(c){return this._serviceComponent=c};d.prototype._register=function(){if(null!=this._registration)return!1;null!=this._preRegistration&&this._preRegistration.apply(this._component,[]);this._registration=this._hub.registerService(this._component,this._contract,this._properties,HUBU.UTILS.createProxyForContract(this._contract,this._component));HUBU.logger.debug("Service from "+this._component.getComponentName()+" registered");
null!=this._postRegistration&&this._postRegistration.apply(this._component,[this._registration]);return!0};d.prototype._unregister=function(){if(null==this._registration)return!1;null!=this._preUnregistration&&this._preUnregistration.apply(this._component,[this._registration]);this._hub.unregisterService(this._registration);this._registration=null;if(null!=this._postUnRegistration)return this._postUnRegistration.apply(this._component,[])};d.prototype.onStart=function(){};d.prototype.onStop=function(){return this._unregister()};
d.prototype.onValidation=function(){return this._register()};d.prototype.onInvalidation=function(){return this._unregister()};return d}();HUBU.ServiceOrientation=e=function(){function d(c){var a,b;this._hub=c;this._registry=new SOC.ServiceRegistry(this._hub);this._components=[];a=this._registry;b=this;this._hub.getServiceRegistry=function(){return a};this._hub.registerService=function(b,c,d,e){return a.registerService(b,c,d,e)};this._hub.unregisterService=function(b){return a.unregisterService(b)};
this._hub.getServiceReferences=function(b,c){return a.getServiceReferences(b,c)};this._hub.getServiceReference=function(b,c){var d;d=a.getServiceReferences(b,c);return 0!==d.length?d[0]:null};this._hub.getService=function(b,c){return a.getService(b,c)};this._hub.ungetService=function(b,c){return a.ungetService(b,c)};this._hub.registerServiceListener=function(b){return a.registerServiceListener(b)};this._hub.unregisterServiceListener=function(b){return a.unregisterServiceListener(b)};this._hub.requireService=
function(a){b.requireService(a);return this};this._hub.provideService=function(a){b.provideService(a);return this};this._hub.locateService=function(a,c){var d,e,g,j,k;k=b._components;g=0;for(j=k.length;g<j;g++)e=k[g],e.component===a&&(d=e);if(null==d)return null;e=d.serviceComponent.getServiceDependencyByName(c);if(null==e)throw new Exception("No dependency "+c+" on component "+d.component.getComponentName());d=e.locateServices();return null===d||0===d.length?null:d[0]};this._hub.locateServices=function(a,
c){var d,e,g,j,k;k=b._components;g=0;for(j=k.length;g<j;g++)e=k[g],e.component===a&&(d=e);if(null==d)return null;e=d.serviceComponent.getServiceDependencyByName(c);if(null==e)throw new Exception("No dependency "+c+" on component "+d.component.getComponentName());d=e.locateServices();return null===d||0===d.length?[]:d}}d.prototype._hub=null;d.prototype._registry=null;d.prototype._components=[];d.prototype.unregisterComponent=function(c){var a,b,d,e;e=this._components;b=0;for(d=e.length;b<d;b++)a=e[b],
null!=a&&a.component===c&&(a.serviceComponent.onStop(),HUBU.UTILS.removeElementFromArray(this._components,a));return this._registry.unregisterServices(c)};d.prototype.requireService=function(c){var a,b,d,e,i,h,g,j;d=c.component;e=c.contract;h=c.filter;a=c.aggregate;g=c.optional;i=c.field;b=c.bind;j=c.unbind;c=c.name;if(null==d)throw new Exception("Cannot require a service without a valid component");null==a&&(a=!1);null==g&&(g=!1);null==e&&(e=null);null==h&&(h=null);if(null==i&&null==b&&null==c)throw new Exception("Cannot require a service - field or bind must be set");
null==i&&(i=null);null==b&&(b=null);null==j&&(j=null);null==c&&(c=e);null==i&&null==b&&(g=!0);a=new HUBU.ServiceDependency(d,e,h,a,g,i,b,j,c,this._hub);return this._addServiceDependencyToComponent(d,a)};d.prototype.provideService=function(c){var a,b,d,e,i,h;a=c.component;b=c.contract;h=c.properties;e=c.preRegistration;d=c.postRegistration;i=c.preUnregistration;c=c.postUnregistration;if(null==a)throw new Exception("Cannot provided a service without a valid component");if(null==b)throw new Exception("Cannot provided a service without a valid contract");
null==h&&(h={});b=new HUBU.ProvidedService(a,b,h,e,d,i,c,this._hub);return this._addProvidedServiceToComponent(a,b)};d.prototype._addServiceDependencyToComponent=function(c,a){var b,d,e,i,h,g;e=!1;g=this._components;i=0;for(h=g.length;i<h;i++)d=g[i],d.component===c&&(b=d);null==b&&(b={component:c,serviceComponent:new HUBU.ServiceComponent(c)},this._components.push(b),e=!0);b.serviceComponent.addRequiredService(a);if(e&&this._hub.isStarted())return b.serviceComponent.onStart()};d.prototype._addProvidedServiceToComponent=
function(c,a){var b,d,e,i,h,g;e=!1;g=this._components;i=0;for(h=g.length;i<h;i++)d=g[i],d.component===c&&(b=d);null==b&&(b={component:c,serviceComponent:new HUBU.ServiceComponent(c)},this._components.push(b),e=!0);b.serviceComponent.addProvidedService(a);if(this._hub.isStarted()&&e)return b.serviceComponent.onStart()};d.prototype.start=function(){var c,a,b,d,e;d=this._components;e=[];a=0;for(b=d.length;a<b;a++)c=d[a],e.push(c.serviceComponent.onStart());return e};d.prototype.stop=function(){var c,
a,b,d,e;d=this._components;e=[];a=0;for(b=d.length;a<b;a++)c=d[a],e.push(c.serviceComponent.onStop());return e};return d}();getHubuExtensions().service=e}).call(this);
(function(){HUBU.Hub=function(){function e(){this._components=[];this._started=!1;this._extensions=null}e.prototype._components=null;e.prototype._started=!1;e.prototype._extensions=null;e.prototype._parentHub=null;e.prototype._name=null;e.prototype.configure=function(d,c){var a,b,e;null!=d&&(this._parentHub=d);null==this._name&&(this._name=null!=(null!=c?c.component_name:void 0)?c.component_name:"hub");if(null==this._extensions)for(b in this._extensions=[],e=getHubuExtensions(),e)a=e[b],this._extensions.push(new a(this));
else HUBU.logger.debug("Hub already initialized");return this};e.prototype.getParentHub=function(){return this._parentHub};e.prototype.getComponents=function(){return this._components};e.prototype.getComponent=function(d){var c,a,b,e,l;if(null==d)return null;l=this._components;b=0;for(e=l.length;b<e;b++)if(c=l[b],a=c.getComponentName,null!=a&&HUBU.UTILS.isFunction(a)&&(a=a.apply(c,[]),a===d))return c;return null};e.prototype.registerComponent=function(d,c){var a,b,e,l;if(null==d)throw new Exception("Cannot register component - component is null");
if(!HUBU.UTILS.isComponent(d)){if(d.getComponentName)throw new Exception(d.getComponentName()+" is not a valid component");throw new Exception(d+" is not a valid component");}null===this._extensions&&this.configure();if(null!=this.getComponent(d.getComponentName()))return HUBU.logger.info("Component "+d.getComponentName()+" already registered"),this;this._components.push(d);null!=c&&null!=c.component_name&&(d.__name__=c.component_name,d.getComponentName=function(){return this.__name__});null==d.__hub__&&
null==d.hub&&(d.__hub__=this,d.hub=function(){return this.__hub__});HUBU.logger.debug("Registering component "+d.getComponentName());l=this._extensions;b=0;for(e=l.length;b<e;b++)a=l[b],HUBU.UTILS.invoke(a,"registerComponent",[d,c]);HUBU.logger.debug("Configuring component "+d.getComponentName());d.configure(this,c);this._started&&(HUBU.logger.debug("Starting component "+d.getComponentName()),d.start());HUBU.logger.debug("Component "+d.getComponentName()+" registered");return this};e.prototype.createInstance=
function(d,c){if(null==d)throw new Exception("Cannot create instance - the given factory / constructor is null");if(!HUBU.UTILS.isFunction(d))throw new Exception("Cannot create instance - the given factory / constructor is not a function");return this.registerComponent(new d,c)};e.prototype.unregisterComponent=function(d){var c,a,b,e,l;if(null==d)return this;if("string"===HUBU.UTILS.typeOf(d)){if(d=this.getComponent(d),null==d)return this}else if(!HUBU.UTILS.isComponent(d))throw(new Exception("Cannot unregister component, it's not a valid component")).add("component",
d);null===this._extensions&&this.configure();a=HUBU.UTILS.indexOf(this._components,d);if(-1!==a){l=this._extensions;b=0;for(e=l.length;b<e;b++)c=l[b],HUBU.UTILS.invoke(c,"unregisterComponent",[d]);d.stop();this._components.splice(a,1)}else HUBU.logger.info("Component "+d.getComponentName()+" not unregistered - not on the hub");return this};e.prototype.start=function(){var d,c,a,b;if(this._started)return this;null===this._extensions&&this.configure();b=this._extensions;c=0;for(a=b.length;c<a;c++)d=
b[c],HUBU.UTILS.invoke(d,"start",[]);this._started=!0;b=this._components;c=0;for(a=b.length;c<a;c++)d=b[c],d.start();return this};e.prototype.stop=function(){var d,c,a,b;if(!this._started)return this;this._started=!1;b=this._components;c=0;for(a=b.length;c<a;c++)d=b[c],d.stop();b=this._extensions;c=0;for(a=b.length;c<a;c++)d=b[c],HUBU.UTILS.invoke(d,"start",[]);return this};e.prototype.isStarted=function(){return this._started};e.prototype.reset=function(){var d,c,a,b,e;this.stop();c=this._name;null===
this._extensions&&this.configure();e=this._extensions;a=0;for(b=e.length;a<b;a++)d=e[a],HUBU.UTILS.invoke(d,"reset",[]);this._components=[];this._extensions=null;this._name=c;return this};e.prototype.getComponentName=function(){return this._name};return e}();getGlobal().hub=(new HUBU.Hub).configure(null,{component_name:"root"})}).call(this);